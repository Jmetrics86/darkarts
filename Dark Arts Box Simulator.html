<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kickstarter Logistics Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        /* Custom focus rings for better accessibility */
        input:focus-visible, button:focus-visible {
            outline: 2px solid #4f46e5;
            outline-offset: 2px;
        }
    </style>

    <script>
        function simulator() {
            return {
                // --- DATA ---
                components: {
                    "Base Game (Cards + Manual)": {
                        l: 250, w: 250, h: 50, // Effective bounding box for cards/manual/tuckboxes
                        weightKg: 1.21,
                        pricing: { 
                            500: 9.01, 750: 7.23, 1000: 6.37, 1500: 5.52, 
                            2000: 5.09, 2500: 4.84, 3000: 4.59, 5000: 4.03 
                        },
                        required: true,
                        color: '#6366f1'
                    },
                    "Playmat (Rubber)": {
                        l: 350, w: 60, h: 60, // Rolled cylinder footprint
                        weightKg: 0.40,
                        pricing: { 
                            300: 2.22, 500: 1.89, 1000: 1.64, 
                            1500: 1.56, 2000: 1.51, 3000: 1.44 
                        },
                        required: false,
                        color: '#94a3b8'
                    },
                    "Extra Playmat (Rubber)": {
                        l: 350, w: 60, h: 60,
                        weightKg: 0.40,
                        pricing: { 
                            300: 2.22, 500: 1.89, 1000: 1.64, 
                            1500: 1.56, 2000: 1.51, 3000: 1.44 
                        },
                        required: false,
                        color: '#cbd5e1'
                    },
                    "Paper Playmat (Rules Sheet)": {
                        l: 150, w: 100, h: 2,
                        weightKg: 0.045,
                        pricing: { 
                            500: 0.25, 750: 0.19, 1000: 0.15, 1500: 0.13, 
                            2000: 0.09, 2500: 0.11, 3000: 0.09, 5000: 0.08 
                        },
                        required: false,
                        color: '#818cf8'
                    },
                    "Extra Paper Playmat (2nd Player)": {
                        l: 150, w: 100, h: 2,
                        weightKg: 0.045,
                        pricing: { 
                            500: 0.25, 750: 0.19, 1000: 0.15, 1500: 0.13, 
                            2000: 0.09, 2500: 0.11, 3000: 0.09, 5000: 0.08 
                        },
                        required: false,
                        color: '#a5b4fc'
                    },
                    "Sleeves (Pack)": {
                        l: 90, w: 65, h: 20,
                        weightKg: 0.20,
                        pricing: { 
                            300: 3.57, 500: 3.44, 1000: 3.21, 
                            1500: 3.18, 2000: 3.16, 3000: 3.02 
                        },
                        required: false,
                        color: '#38bdf8'
                    },
                    "Art Book (Hardcover)": {
                        l: 260, w: 210, h: 5,
                        weightKg: 0.398,
                        pricing: { 
                            300: 6.31, 500: 4.00, 1000: 2.45, 
                            1500: 1.98, 2000: 1.76, 3000: 1.54 
                        },
                        required: false,
                        color: '#fb923c'
                    },
                    "Tokens (Punchboard)": {
                        l: 300, w: 200, h: 3,
                        weightKg: 0.15,
                        pricing: { 
                            500: 1.45, 750: 0.97, 1000: 0.73, 
                            1500: 0.49, 2500: 0.37, 3000: 0.24, 5000: 0.15 
                        },
                        required: false,
                        color: '#fbbf24'
                    }
                },
                fixedCosts: {
                    "Safety Testing": 600,
                    "Base Tooling": 66,
                    "Token Tooling": 90,
                    "Sleeve Tooling": 85,
                    "Playmat Film": 150,
                    "Loan Repayment": 3300
                },

                // --- STATE ---
                boxL: 356,
                boxW: 356,
                boxH: 153,
                qty: 1500,
                pledgePrice: 59.99,
                shippingCharge: 20,
                selectedItems: [
                    "Base Game (Cards + Manual)", 
                    "Paper Playmat (Rules Sheet)", 
                    "Extra Paper Playmat (2nd Player)", 
                    "Art Book (Hardcover)", 
                    "Tokens (Punchboard)"
                ],

                // --- METHODS ---
                toggleItem(name) {
                    if (this.components[name].required) return;
                    if (this.selectedItems.includes(name)) {
                        this.selectedItems = this.selectedItems.filter(i => i !== name);
                    } else {
                        this.selectedItems.push(name);
                    }
                },

                formatCurrency(val) {
                    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);
                },

                results() {
                    let totalCompVolume = 0;
                    let totalWeightKg = 0;
                    let stackedHeight = 0;
                    let warnings = [];
                    let manifest = [];
                    let tiersAchieved = [];

                    this.selectedItems.forEach(itemKey => {
                        const data = this.components[itemKey];
                        totalWeightKg += data.weightKg;
                        stackedHeight += data.h;
                        totalCompVolume += (data.l * data.w * data.h);

                        // Fit check logic
                        const fitsNormally = data.l <= this.boxL && data.w <= this.boxW;
                        const fitsRotated = data.w <= this.boxL && data.l <= this.boxW;
                        const individualFit = fitsNormally || fitsRotated;

                        manifest.push({
                            name: itemKey,
                            dims: `${data.l}x${data.w}x${data.h}mm`,
                            weight: `${data.weightKg.toFixed(3)}kg`,
                            fits: individualFit,
                            color: data.color,
                            l: data.l,
                            w: data.w
                        });

                        if (!individualFit) {
                            warnings.push(`${itemKey} is physically too large for the box footprint.`);
                        }

                        // Pricing Tier Lookup
                        const pricing = data.pricing;
                        const sortedTiers = Object.keys(pricing).map(Number).sort((a, b) => a - b);
                        let bestTier = sortedTiers[0];
                        for (let t of sortedTiers) {
                            if (this.qty >= t) bestTier = t;
                        }
                        const price = pricing[bestTier];
                        tiersAchieved.push({ name: itemKey, tier: bestTier, price: price });
                    });

                    // Calculated Financials
                    const unitMfgCost = tiersAchieved.reduce((sum, t) => sum + t.price, 0);
                    const freight = unitMfgCost * 0.30;
                    const tariffs = unitMfgCost * 0.20;
                    const landedCost = unitMfgCost + freight + tariffs;
                    const fulfillmentTotal = 21.96 + 1.92;
                    const ksFee = (this.pledgePrice + this.shippingCharge) * 0.10;
                    const contingencyFee = (landedCost + fulfillmentTotal) * 0.15;
                    const totalVariableCost = landedCost + fulfillmentTotal + ksFee + contingencyFee;
                    const unitProfit = (this.pledgePrice + this.shippingCharge) - totalVariableCost;

                    const boxVolume = Math.max(1, this.boxL * this.boxW * this.boxH);
                    const efficiencyThreshold = boxVolume * 0.85;
                    
                    if (stackedHeight > this.boxH) {
                        warnings.push(`Warning: Combined stacked height (${stackedHeight}mm) exceeds box height (${this.boxH}mm).`);
                    }

                    return {
                        isOverfilled: totalCompVolume > efficiencyThreshold || stackedHeight > this.boxH,
                        warnings,
                        capPercent: ((totalCompVolume / boxVolume) * 100).toFixed(1),
                        unitMfgCost, landedCost, unitProfit,
                        totalVariableCost, freight, tariffs, fulfillment: fulfillmentTotal, ksFee, contingencyFee,
                        netProjectProfit: (unitProfit * this.qty) - 4056, // Adjusted to match fixed costs sum in img
                        totalFixed: 4056,
                        tiersAchieved, manifest, stackedHeight,
                        totalWeightLbs: totalWeightKg * 2.20462,
                        totalWeightKg,
                        subsidy: fulfillmentTotal - this.shippingCharge
                    };
                }
            };
        }
    </script>

    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900 font-sans p-4 md:p-8">

<div x-data="simulator()" x-cloak class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
    
    <!-- Sidebar -->
    <aside class="lg:col-span-3 space-y-6">
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-6">
            <h1 class="text-xl font-bold flex items-center gap-2 text-indigo-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>
                Project Simulator
            </h1>

            <section class="space-y-4">
                <h2 class="text-[11px] font-bold uppercase tracking-widest text-slate-400">Box Dimensions (mm)</h2>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1">Length</label>
                        <input type="number" x-model.number="boxL" class="w-full p-2 border rounded-lg text-sm bg-slate-50">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1">Width</label>
                        <input type="number" x-model.number="boxW" class="w-full p-2 border rounded-lg text-sm bg-slate-50">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1">Height</label>
                        <input type="number" x-model.number="boxH" class="w-full p-2 border rounded-lg text-sm bg-slate-50">
                    </div>
                </div>
            </section>

            <section class="space-y-4">
                <h2 class="text-[11px] font-bold uppercase tracking-widest text-slate-400">Campaign Stats</h2>
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1">Production Volume</label>
                        <input type="number" step="100" x-model.number="qty" class="w-full p-2 border rounded-lg text-sm">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-1">Pledge $</label>
                            <input type="number" step="0.01" x-model.number="pledgePrice" class="w-full p-2 border rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-1">Shipping $</label>
                            <input type="number" x-model.number="shippingCharge" class="w-full p-2 border rounded-lg text-sm">
                        </div>
                    </div>
                </div>
            </section>

            <section class="space-y-2">
                <h2 class="text-[11px] font-bold uppercase tracking-widest text-slate-400 mb-4">Include Components</h2>
                <template x-for="(data, name) in components" :key="name">
                    <button @click="toggleItem(name)" :disabled="data.required"
                        :class="selectedItems.includes(name) ? 'border-indigo-600 bg-indigo-50 text-indigo-700' : 'border-slate-200 bg-white'"
                        class="w-full flex items-center justify-between p-3 rounded-xl border text-left text-sm transition-all">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V7M4 7c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2M4 7l8-4 8 4M12 3v18" /></svg>
                            <span x-text="name"></span>
                        </span>
                        <template x-if="selectedItems.includes(name)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                        </template>
                    </button>
                </template>
            </section>
        </div>
    </aside>

    <!-- Main Dashboard -->
    <main class="lg:col-span-9 space-y-6">
        
        <!-- Top Status -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div :class="results().isOverfilled ? 'bg-red-50 border-red-200' : 'bg-emerald-50 border-emerald-100'" class="p-6 rounded-2xl shadow-sm border-2">
                <span :class="results().isOverfilled ? 'bg-red-100 text-red-700' : 'bg-emerald-100 text-emerald-700'" class="text-[10px] font-bold px-2 py-1 rounded-full uppercase">Spatial Status</span>
                <h3 class="text-xl font-black mt-2" x-text="results().isOverfilled ? 'Box Overflow' : 'Fits Comfortably'"></h3>
                <p class="text-xs text-slate-500 mt-1">Volume used: <span class="font-bold text-slate-900" x-text="results().capPercent + '%'"></span></p>
            </div>
            <div :class="results().unitProfit < 0 ? 'bg-rose-50 border-rose-200' : 'bg-indigo-50 border-indigo-100'" class="p-6 rounded-2xl shadow-sm border-2">
                <span :class="results().unitProfit < 0 ? 'bg-rose-100 text-rose-700' : 'bg-indigo-100 text-indigo-700'" class="text-[10px] font-bold px-2 py-1 rounded-full uppercase">Profitability</span>
                <h3 class="text-xl font-black mt-2" x-text="results().unitProfit < 0 ? 'Under Water' : 'Target Profit Met'"></h3>
                <p class="text-xs text-slate-500 mt-1">Est. Net: <span class="font-bold text-slate-900" x-text="formatCurrency(results().netProjectProfit)"></span></p>
            </div>
        </div>

        <!-- Breakdown -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <template x-for="stat in [
                    ['Unit Mfg', '$' + results().unitMfgCost.toFixed(2)],
                    ['Landed Cost', '$' + results().landedCost.toFixed(2)],
                    ['KS Fee', '$' + results().ksFee.toFixed(2), 'text-rose-500'],
                    ['Contingency', '$' + results().contingencyFee.toFixed(2), 'text-amber-600'],
                    ['Net / Unit', '$' + results().unitProfit.toFixed(2), results().unitProfit < 0 ? 'text-rose-600' : 'text-emerald-600']
                ]">
                    <div>
                        <div class="text-[10px] text-slate-400 font-bold uppercase mb-1" x-text="stat[0]"></div>
                        <div class="text-lg font-black" :class="stat[2]" x-text="stat[1]"></div>
                    </div>
                </template>
            </div>

            <div class="space-y-4">
                <div class="flex justify-between items-center text-xs font-bold text-slate-600 uppercase">
                    <span>Variable Cost Distribution</span>
                    <span x-text="'Total: $' + results().totalVariableCost.toFixed(2)"></span>
                </div>
                <div class="h-4 w-full bg-slate-100 rounded-full flex overflow-hidden">
                    <div class="bg-indigo-500 h-full" :style="'width: ' + (results().unitMfgCost/results().totalVariableCost*100) + '%'"></div>
                    <div class="bg-sky-400 h-full" :style="'width: ' + (results().freight/results().totalVariableCost*100) + '%'"></div>
                    <div class="bg-orange-400 h-full" :style="'width: ' + (results().tariffs/results().totalVariableCost*100) + '%'"></div>
                    <div class="bg-emerald-400 h-full" :style="'width: ' + (results().fulfillment/results().totalVariableCost*100) + '%'"></div>
                    <div class="bg-rose-400 h-full" :style="'width: ' + (results().ksFee/results().totalVariableCost*100) + '%'"></div>
                    <div class="bg-amber-400 h-full" :style="'width: ' + (results().contingencyFee/results().totalVariableCost*100) + '%'"></div>
                </div>
            </div>
        </div>

        <!-- NEW: Physical Manifest & Visualization -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                <h2 class="text-xs font-bold uppercase tracking-widest text-slate-500">Physical Manifest & Fit Diagnostic</h2>
                <div class="text-[10px] font-bold text-slate-400 uppercase">
                    Stacked Height: <span :class="results().stackedHeight > boxH ? 'text-rose-600' : 'text-slate-600'" x-text="results().stackedHeight + 'mm'"></span> / <span x-text="boxH + 'mm'"></span>
                </div>
            </div>
            
            <div class="p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Data Table -->
                <div class="lg:col-span-7 overflow-x-auto">
                    <table class="w-full text-left text-[11px]">
                        <thead>
                            <tr class="text-slate-400 uppercase tracking-tighter border-b border-slate-100">
                                <th class="pb-2 font-bold">Item</th>
                                <th class="pb-2 font-bold">Dims (mm)</th>
                                <th class="pb-2 font-bold text-right">Weight</th>
                                <th class="pb-2 font-bold text-center">Fit</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-50">
                            <template x-for="item in results().manifest" :key="item.name">
                                <tr>
                                    <td class="py-3 font-semibold flex items-center gap-2 text-slate-700">
                                        <div class="w-2 h-2 rounded-full" :style="'background-color: ' + item.color"></div>
                                        <span x-text="item.name"></span>
                                    </td>
                                    <td class="py-3 font-mono text-slate-500" x-text="item.dims"></td>
                                    <td class="py-3 text-right text-slate-600" x-text="item.weight"></td>
                                    <td class="py-3 text-center">
                                        <span x-show="item.fits" class="text-emerald-500">âœ“</span>
                                        <span x-show="!item.fits" class="text-rose-500 font-bold">FAIL</span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                        <tfoot>
                            <tr class="border-t-2 border-slate-100 font-bold text-slate-900">
                                <td class="pt-3">TOTAL PACKAGE</td>
                                <td class="pt-3">Stacked: <span x-text="results().stackedHeight + 'mm'"></span></td>
                                <td class="pt-3 text-right" x-text="results().totalWeightLbs.toFixed(2) + ' lbs'"></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- Visualization -->
                <div class="lg:col-span-5 bg-slate-50 rounded-xl p-4 flex flex-col items-center justify-center">
                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-3">2D Box Footprint Visualization</div>
                    <div class="relative border-2 border-slate-300 bg-white shadow-inner" 
                         :style="`width: 200px; height: 200px;` ">
                        <!-- Item blocks projected on footprint -->
                        <template x-for="item in results().manifest">
                            <div class="absolute opacity-40 border border-black/10"
                                 :style="`
                                    left: 0; 
                                    top: 0; 
                                    width: ${Math.min(100, (item.l / boxL) * 100)}%; 
                                    height: ${Math.min(100, (item.w / boxW) * 100)}%;
                                    background-color: ${item.color};
                                 `"
                                 :title="item.name">
                            </div>
                        </template>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-x-4 gap-y-1 w-full">
                        <div class="text-[9px] text-slate-400 uppercase">Box Size: <span class="text-slate-700 font-bold" x-text="boxL + 'x' + boxW"></span></div>
                        <div class="text-[9px] text-slate-400 uppercase text-right">Max Stack: <span class="text-slate-700 font-bold" x-text="boxH"></span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footnote -->
        <div class="p-6 bg-indigo-50 border border-indigo-100 rounded-2xl">
            <h4 class="text-sm font-bold text-indigo-900 mb-1">QML Fulfillment Analysis</h4>
            <p class="text-xs text-indigo-800 leading-relaxed">
                Total fulfillment cost is <span class="font-bold">$23.88</span> ($21.96 Base + $1.92 Fuel). 
                Charging <span class="font-bold" x-text="'$' + shippingCharge.toFixed(2)"></span> results in a subsidy of 
                <span class="font-bold" x-text="formatCurrency(results().subsidy)"></span> per unit.
                Configuration weight: <span class="font-bold" x-text="results().totalWeightLbs.toFixed(2) + ' lbs'"></span>.
            </p>
        </div>

        <!-- Achievement Tiers Diagnostic -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4">
            <h2 class="text-[11px] font-bold uppercase tracking-widest text-slate-400 mb-4 px-2">Diagnostic: Achievement Tiers</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                <template x-for="item in results().tiersAchieved" :key="item.name">
                    <div class="p-3 rounded-lg bg-slate-50 border border-slate-100">
                        <div class="text-[9px] font-bold text-slate-400 uppercase truncate" x-text="item.name"></div>
                        <div class="text-indigo-600 font-black text-sm mt-1" x-text="item.tier + '+ units'"></div>
                        <div class="text-[10px] font-medium text-slate-500" x-text="'Price: $' + item.price.toFixed(2)"></div>
                    </div>
                </template>
            </div>
        </div>
    </main>
</div>

</body>
</html>
